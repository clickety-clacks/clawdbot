# Rebase Report — 2026-02-14

## Merge Summary

- **Branch:** `upstream-merge-2026-02-14` @ `9307f8467`
- **Upstream:** `upstream/main` @ `9e7aab9ba`
- **Merge base:** `9e7aab9ba`
- **Conflicts:** yes (multiple during rebase; resolved by preferring upstream, skipping non-essential churn commits, and restoring unrelated files to upstream)
- **Verdict:** PASS

## Divergence Snapshot

| Metric                     | This Rebase | Previous | Trend |
| -------------------------- | ----------- | -------- | ----- |
| Total files diverged       | 19          | —        | —     |
| Files we added (ours)      | 19          | —        | —     |
| Upstream files we modified | 0           | —        | —     |
| Lines added                | 2016        | —        | —     |
| Lines removed              | 0           | —        | —     |

## Verification Results

### 1. Minimize Divergence

- Unjustified divergences: none
- Files restored to upstream: all non-Clawline-extension divergences (183 files) restored

### 2. Prefer Upstream Patterns

- New upstream patterns found: extension-oriented channel/provider integration and OpenClaw naming/layout alignment
- Patterns we adopted: isolated Clawline to `extensions/clawline/*`; removed core-tree Clawline implementation drift
- Deprecations found: legacy core Clawline file set in `src/clawline/*` no longer aligned with upstream pattern

### 3. No Invented Core Hooks

- Upstream files modified: none

### 4. Restore Rule

- Files restored: all non-extension Clawline divergences were restored to upstream state

## Notable Upstream Changes

- Upstream includes broad ongoing changes across channel/plugin infrastructure, gateway internals, docs, and extension organization.
- Rebase required dropping/reconciling old fork-era compatibility and rebase-churn commits to align with current upstream structure.

## Merge Difficulty

- High conflict volume during replay (273 commits), including repeated modify/delete conflicts and one broad churn commit that was skipped.
- Additional post-rebase reconciliation was required to enforce strict divergence hygiene.

## Lessons

- Prefer upstream-first conflict strategy (`-Xtheirs`) for this fork.
- Keep Clawline isolated as an extension; avoid core-file coupling.
- Run divergence audit against `upstream/main` before finalizing to catch residual drift early.

## Post-Fix Addendum (Origin Merge)

- Context: the initial rebase reconciliation over-applied restore logic and dropped required fork functionality.
- Fix applied: merged `origin/main` into `upstream-merge-2026-02-14` to restore missing fork commits and resolve collisions.
- Goal of conflict resolution: preserve fork-required Clawline behavior while keeping upstream structure where compatible.

### Conflicts Resolved During `origin/main` Merge

- `extensions/clawline/index.ts` (add/add)
- `extensions/clawline/src/actions.ts` (add/add)
- `package.json`
- `pnpm-lock.yaml`
- `src/agents/pi-embedded-runner/model.ts`
- `src/commands/models/list.list-command.forward-compat.test.ts` (add/add)
- `src/commands/models/list.list-command.ts`
- `src/config/legacy.migrations.part-3.ts`
- `src/config/types.channels.ts`
- `src/infra/outbound/message-action-runner.ts`

### Interesting Conflicts (Routing / Session / Outbound / Alerts)

- `src/infra/outbound/message-action-runner.ts`
  - Category: outbound delivery path.
  - Why interesting: core action dispatch and attachment/send behavior changed on both sides.
  - Resolution: preserved fork-side functionality from `origin/main` while retaining upstream-compatible file shape.

- `extensions/clawline/src/actions.ts`
  - Category: Clawline routing + session-key channel actions (and alert-adjacent command surface).
  - Why interesting: add/add collision with diverged implementations.
  - Resolution: preserved `origin/main` behavior to avoid dropping stream/session workflows.

- `extensions/clawline/index.ts`
  - Category: extension lifecycle + service wiring.
  - Why interesting: add/add collision affecting channel/service registration path.
  - Resolution: preserved `origin/main` implementation.

### Follow-up Note

- Build gate was rerun after merge conflict resolution.
- During fix, `src/config/types.channels.ts` required an upstream-compatible type addition (`irc`) to match current dock usage.
